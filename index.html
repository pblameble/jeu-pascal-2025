<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jeu Pascal 2025</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }
    .app {
      max-width: 400px;
      width: 100%;
      background: white;
      padding: 20px;
      margin: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    h1, h2 {
      text-align: center;
    }
    .intro {
      font-size: 1em;
      line-height: 1.5;
      margin-bottom: 20px;
      text-align: justify;
    }
    .carquois-img, .puits-img {
      width: 100%;
      max-height: 200px;
      object-fit: cover;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    button {
      width: 100%;
      padding: 12px;
      font-size: 1em;
      background: #8B4513;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover {
      background: #A0522D;
    }
    .question, .options {
      margin-bottom: 20px;
    }
    .options label {
      display: block;
      margin-bottom: 8px;
    }
    .feedback {
      text-align: center;
      margin-top: 10px;
      color: red;
    }
    #qr-reader {
      width: 100%;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="app">
    <div id="main-container">
      <h1>Jeu Pascal 2025</h1>
      <img src="carquois.jpg" alt="Carquois" class="carquois-img" />
      <div class="intro">
        Bonjour et bienvenue √† l‚Äô√©dition 2025 du <strong>Jeu Pascal</strong> !<br><br>
        Apr√®s une ann√©e olympique, cette √©dition s‚Äôannonce historique : <strong>Dianou</strong> atteindra enfin la majorit√©‚Ä¶ 
        et peut-√™tre ne sera-t-elle plus √©ligible au Jeu Pascal ? <em>√Ä suivre !</em><br><br>
        Cette ann√©e, le lieu change : fini le ch√¢teau ! Nous voil√† tout pr√®s du <strong>manoir Saint-Michel</strong>, aux c√¥t√©s de la m√®re Michelle‚Ä¶
      </div>
      <button onclick="startQuiz()">üèπ Commencer la chasse</button>
    </div>
  </div>

  <script>
    const questions = [
      {
        type: "qcm",
        question: "Quelle est la capitale de la France ? (√©chauffement)",
        options: ["Lyon", "Paris", "Marseille", "Fort de France"],
        answer: "Paris"
      },
      {
        type: "qr",
        question: `Vous le voyez sur la carte :<br>
        <img src='puits.png' alt='Puits' class='puits-img' /><br><br>
        Il y a une rue qui permet de creuser tr√®s profond‚Ä¶<br>
        Mais pas besoin d‚Äôaller si loin pour trouver le prochain indice.`,
        expectedQr: "qr-1"
      },
      {
        type: "qr",
        question: "Bravo, maintenant le prochain indice se trouve √† un endroit o√π vous pouvez toucher le ciel sans jamais vous envoler",
        expectedQr: "qr-2"
      },
      {
        type: "qr",
        question: "Le prochai indice se trouve √† l'endroit o√π se cache un ingr√©dient essentiel pour pr√©parer des cr√™pes compl√®tes. Sans moi, tes cr√™pes seraient bien moins savoureuses",
        expectedQr: "qr-3"
      },
      {
        type: "qr",
        question: "Ici, tu trouveras des v√©los, des bo√Ætes poussi√©reuses, et peut-√™tre m√™me une vieille radio. Mais cherche bien, car l'objet qui t'int√©resse a des lames tranchantes et un moteur puissant",
        expectedQr: "qr-4"
      },
      {
        type: "qr",
        question: "Je suis un appareil moderne qui transforme les pixels en r√©alit√©. Pour me r√©veiller, il te faudra un objet bien pr√©cis, appartenant √† une personne sp√©ciale. Qui suis-je ?",
        expectedQr: "qr-5"
      },
      {
        type: "qr",
        question: "Pour me trouver, tu devras quitter la propri√©t√© et te diriger vers un lieu majestueux. Cherche les couleurs flottant au vent, elles te guideront vers l'entr√©e d'un manoir historique. O√π suis-je ?",
        expectedQr: "qr-6"
      },
      {
        type: "qr",
        question: "Je suis une porte qui, une fois, a failli causer un grand danger. Rest√©e ferm√©e trop longtemps, j'ai presque d√©clench√© un incendie. O√π suis-je ?",
        expectedQr: "qr-7"
      },
      {
        type: "qr",
        question: "Je suis un objet qui, bien que silencieux et immobile, donne l'heure exacte deux fois par jour. Cherche-moi l√† o√π le temps semble s'√™tre arr√™t√©. ",
        expectedQr: "qr-8"
      },
      {
        type: "qr",
        question: "Je suis un v√©hicule qui, malgr√© les √©motions fortes d'hier, reste en parfait √©tat. Cherche-moi l√† o√π les routes m√®nent √† l'aventure.",
        expectedQr: "qr-9"
      },
      {
        type: "qr",
        question: "üéÅ Bravo ! Potager Vous √™tes tout proche du tr√©sor. Scannez pour terminer la chasse !",
        expectedQr: "qr-10"
      }
    ];

    let currentIndex = 0;
    let html5QrCode;

    function startQuiz() {
      showQuestion();
    }

    function showQuestion() {
      const container = document.getElementById('main-container');
      const q = questions[currentIndex];
      container.innerHTML = `<div class="question"><h2>Q${currentIndex + 1}</h2><p>${q.question}</p></div>`;

      if (q.type === "qcm") {
        container.innerHTML += `
          <div class="options">
            ${q.options.map(opt => `
              <label>
                <input type="radio" name="option" value="${opt}"> ${opt}
              </label>
            `).join('')}
          </div>
          <button onclick="checkQcmAnswer()">Valider</button>
          <div class="feedback" id="feedback"></div>
        `;
      } else if (q.type === "qr") {
        container.innerHTML += `
          <button onclick="launchQrScanner()">üì∑ Scanner l'indice</button>
          <div id="qr-reader" style="display:none;"></div>
          <div class="feedback" id="feedback"></div>
        `;
      }
    }

    function checkQcmAnswer() {
      const selected = document.querySelector('input[name="option"]:checked');
      const feedback = document.getElementById("feedback");
      if (!selected) {
        feedback.textContent = "Veuillez choisir une r√©ponse.";
        return;
      }
      if (selected.value === questions[currentIndex].answer) {
        nextQuestion();
      } else {
        feedback.textContent = "‚ùå Retente ta chance !";
      }
    }

    function launchQrScanner() {
      const readerDiv = document.getElementById("qr-reader");
      readerDiv.style.display = "block";
      html5QrCode = new Html5Qrcode("qr-reader");
      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        qrCodeMessage => {
          html5QrCode.stop();
          readerDiv.innerHTML = "";
          validateQr(qrCodeMessage);
        },
        errorMessage => {}
      );
    }

    function validateQr(scannedCode) {
      const expected = questions[currentIndex].expectedQr;
      const feedback = document.getElementById("feedback");
      if (scannedCode === expected) {
        nextQuestion();
      } else {
        feedback.textContent = "‚ùå Ce n'est pas le bon endroit.";
      }
    }

    function nextQuestion() {
      if (currentIndex < questions.length - 1) {
        currentIndex++;
        showQuestion();
      } else {
        document.getElementById('main-container').innerHTML = `
          <h2>üèÅ Fin de la chasse !<br>Bravo √† tous, vous avez trouv√© le tr√©sor ! üéâ</h2>
        `;
      }
    }
  </script>
</body>
</html>
