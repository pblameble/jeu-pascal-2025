<script>
  const questions = [
    {
      type: "qcm",
      question: "Quelle f√™te chr√©tienne c√©l√®bre la r√©surrection de J√©sus ?",
      options: ["No√´l", "P√¢ques", "Pentec√¥te", "Ascension"],
      answer: "P√¢ques"
    },
    {
      type: "qcm",
      question: "Quel animal est souvent associ√© √† la distribution des ≈ìufs de P√¢ques ?",
      options: ["Le lapin", "Le coq", "La poule", "Le mouton"],
      answer: "Le lapin"
    },
    {
      type: "qcm",
      question: "Quel aliment est traditionnellement interdit pendant le Car√™me avant P√¢ques ?",
      options: ["Les fruits", "Le chocolat", "La viande", "Le poisson"],
      answer: "La viande"
    },
    {
      type: "qcm",
      question: "En France, qui apporte les ≈ìufs de P√¢ques aux enfants ?",
      options: ["Les cloches", "Le P√®re No√´l", "Le lapin", "La f√©e des ≈ìufs"],
      answer: "Les cloches"
    },
    {
      type: "qcm",
      question: "Quel jour de la semaine c√©l√®bre-t-on P√¢ques ?",
      options: ["Samedi", "Dimanche", "Lundi", "Vendredi"],
      answer: "Dimanche"
    },
    {
      type: "qcm",
      question: "Quelle est la capitale de la France ? (√©chauffement)",
      options: ["Lyon", "Paris", "Marseille", "Fort de France"],
      answer: "Paris"
    },
    // ... QR code questions identiques ...
    {
      type: "qr",
      question: `Vous le voyez sur la carte :<br>
        <img src='puits.png' alt='Puits' class='puits-img' /><br><br>
        Il y a une rue qui permet de creuser tr√®s profond‚Ä¶<br>
        Mais pas besoin d‚Äôaller si loin pour trouver le prochain indice.`,
      expectedQr: "qr-1"
    },
    {
      type: "qr",
      question: "Bravo, maintenant le prochain indice se trouve √† un endroit o√π vous pouvez toucher le ciel sans jamais vous envoler",
      expectedQr: "qr-2"
    },
    {
      type: "qr",
      question: "Le prochai indice se trouve √† l'endroit o√π se cache un ingr√©dient essentiel pour pr√©parer des cr√™pes compl√®tes...",
      expectedQr: "qr-3"
    },
    {
      type: "qr",
      question: "Ici, tu trouveras des v√©los... mais cherche bien...",
      expectedQr: "qr-4"
    },
    {
      type: "qr",
      question: "Je suis un appareil moderne qui transforme les pixels en r√©alit√©...",
      expectedQr: "qr-5"
    },
    {
      type: "qr",
      question: "Pour me trouver, tu devras quitter la propri√©t√©...",
      expectedQr: "qr-6"
    },
    {
      type: "qr",
      question: "Je suis une porte qui, une fois, a failli causer un grand danger...",
      expectedQr: "qr-7"
    },
    {
      type: "qr",
      question: "Je suis un objet qui donne l'heure exacte deux fois par jour...",
      expectedQr: "qr-8"
    },
    {
      type: "qr",
      question: "Je suis un v√©hicule qui reste en parfait √©tat...",
      expectedQr: "qr-9"
    },
    {
      type: "qr",
      question: "Je suis un endroit o√π la nature et les mains humaines...",
      expectedQr: "qr-10"
    }
  ];

  let currentIndex = 0;
  let html5QrCode;
  let score = 0;

  function startQuiz() {
    currentIndex = 0;
    score = 0;
    showQuestion();
  }

  function showQuestion() {
    const container = document.getElementById('main-container');
    const q = questions[currentIndex];
    container.innerHTML = `<div class="question"><h2>Q${currentIndex + 1}</h2><p>${q.question}</p></div>`;

    if (q.type === "qcm") {
      container.innerHTML += `
        <div class="options">
          ${q.options.map(opt => `
            <label>
              <input type="radio" name="option" value="${opt}"> ${opt}
            </label>
          `).join('')}
        </div>
        <button onclick="checkQcmAnswer()">Valider</button>
        <div class="feedback" id="feedback"></div>
        <p>Score actuel : <strong>${score}</strong></p>
      `;
    } else if (q.type === "qr") {
      container.innerHTML += `
        <button onclick="launchQrScanner()">üì∑ Scanner l'indice</button>
        <div id="qr-reader" style="display:none;"></div>
        <div class="feedback" id="feedback"></div>
        <p>Score actuel : <strong>${score}</strong></p>
      `;
    }
  }

  function checkQcmAnswer() {
    const selected = document.querySelector('input[name="option"]:checked');
    const feedback = document.getElementById("feedback");
    if (!selected) {
      feedback.textContent = "Veuillez choisir une r√©ponse.";
      return;
    }
    if (selected.value === questions[currentIndex].answer) {
      score++;
      nextQuestion();
    } else {
      feedback.textContent = "‚ùå Mauvaise r√©ponse ! -1 point";
      score--;
    }
  }

  function launchQrScanner() {
    const readerDiv = document.getElementById("qr-reader");
    readerDiv.style.display = "block";
    html5QrCode = new Html5Qrcode("qr-reader");
    html5QrCode.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      qrCodeMessage => {
        html5QrCode.stop();
        readerDiv.innerHTML = "";
        validateQr(qrCodeMessage);
      },
      errorMessage => {}
    );
  }

  function validateQr(scannedCode) {
    const expected = questions[currentIndex].expectedQr;
    const feedback = document.getElementById("feedback");
    if (scannedCode === expected) {
      score++;
      nextQuestion();
    } else {
      feedback.textContent = "‚ùå Mauvais QR Code ! -1 point";
      score--;
    }
  }

  function nextQuestion() {
    if (currentIndex < questions.length - 1) {
      currentIndex++;
      showQuestion();
    } else {
      document.getElementById('main-container').innerHTML = `
        <h2>üèÅ Fin de la chasse !<br>Bravo √† tous üéâ</h2>
        <p>Votre score final est de : <strong>${score}</strong> point(s)</p>
      `;
    }
  }
</script>
